<!DOCTYPE html>
<html lang="{{language}}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <!-- css library import -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fastly.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../../base/css/style.css">
  </head>
  <body>
    <div  class='custom-landing-page neumi-shop-page no-spacing'>
      <!-- HERO SECTION -->
      {{#hero_section}}
        <div class="banner-layout-1 bg-image shop-banner">
          <div class="container">
            <div class="wrapper clr-white">
              <h1 class="clr-white">{{title}}</h1>
              <p class="mt-8">{{desc}}</p>
              <div class="btn-section is-flex is-wrap col-gap-12">
                <span class="btn btn-primary btn-rounded mt-24 shop-product-button">{{shop_product_button_text}}</span>
              </div>
            </div>
          </div>
        </div>
      {{/hero_section}}
      <!--As seen section-->

      {{>AsSeenOn}}
      <!-- Main Product List -->
      {{#product_list}}
        <div class="main-product-list page-section-top" id="shop-product">
          <div class="container">
            <h2>{{title}}</h2>
            <div class="product-list mt-2">
              <div class="row">
                {{#items}}
                  <div class="col col-12 col-xs-6">
                    <div class="main-product-item mt-30">
                      <div class="image-section">
                        <a href="{{url}}">
                          <img src="{{image}}" alt="" class="w-full">
                        </a>
                      </div>
                      <div class="fs-md fw-600 clr-body mt-12">
                        <a href="{{url}}">{{product_name}}</a>
                      </div>
                      <div class="price mt-4 price-color" style="display: none;" id="product_{{product_id}}">$<span>{{price}}</span></div>

                    </div>
                  </div>
                {{/items}}
              </div><!--.row---->
            </div><!-- .product-list -->

          </div><!-- .container -->
        </div><!-- .main-product-list -->
      {{/product_list}}

      <!-- bundle and multiple product-->
      <div class="page-section">
        <div class="container">
          <!-- Product Bundle section -->
          {{#product_bundle}}
            <div class="product-bundle-section">
              <h2>{{title}}</h2>
              <div class="image-section mt-32">
                <a href="{{url}}">
                  <img src="{{image}}" alt="product" class="w-full"/>
                </a>
              </div>
              <div class="fs-md fw-600 clr-body mt-12">
                <a href="{{url}}">{{product_name}}</a></div>
              <div class="price mt-4 price-color">${{price}}</div>
            </div>
          {{/product_bundle}}

          {{#multiple_product}}
            <div class="multiple-product-list">
              <div class="row">
                {{#items}}
                  <div class="col col-12 col-xs-6 col-lg-4">
                    <div class="product-item mt-30">
                      <div class="image-section">
                        <a href="{{url}}">
                          <img src="{{image}}" alt="product">
                        </a>
                      </div>
                      <div class="fs-md fw-600 clr-body mt-12">
                        <a href="{{url}}">{{product_name}}</a>
                      </div>
                      <div class="price mt-4 price-color">${{price}}</div>

                    </div>
                  </div>
                {{/items}}
              </div><!-- .row -->
            </div><!-- .multiple-product-list -->
          {{/multiple_product}}
        </div>
      </div>

      {{#cta}}
        <div class="cta-section cta-layout-2 page-section clr-bg-700_bg">
          <div class="container">
            <div class="wrapper bg-image image-section overlay overlay-rounded-8" style="background-image: url({{image}});">
              <div class="desc-wrapper">
                <h2 class="clr-white">{{title}}</h2>
                <div class="btn-section is-flex is-wrap col-gap-12 mt-8">
                  <span class="btn btn-primary btn-rounded mt-24 shop-product-button">{{shop_product_button_text}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      {{/cta}}

      <div class="page-note-section pt-32 pb-32">
        <div class="container">
          <div class="caption fs-sm">
            <span>{{note_desc}}</span>
          </div>
        </div>
      </div>

    </div><!-- .neumi-landing-page -->

    <!-- Js library import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        //as seen slider
        var asSeen = new Splide("#as-seen_slider", {
          autoWidth: true,
          arrows: false,
          pagination: false,
          type: "loop",
          perPage: 1,
          autoplay: true,
          interval: 2000,
          cover: false,
          gap: "4rem",
          breakpoints: {
            1024: {
              perPage: 7,
              gap: "3rem",
            },
            576: {
              perPage: 4,
            },
          },
        });

        asSeen.mount();

      });

      $(".shop-product-button").on("click", function () {
        $("html,body").animate({
          scrollTop: $('#shop-product').offset().top + 50 + 'px'
        }, 1000);
        return false;
      });

    </script>
    <script>
      $(window).on('load', async function () {
        console.log('load');
        function extractCookie(...keys) {
          return document.cookie.split(";").filter(item => keys.some(key => item.includes(key))).reduce((acc, item) => {
            const [key, value] = item.trim().split("=")
            acc[key] = value

            return acc
          }, {})
        }

        const cookie = extractCookie('country');
        const country = window.country || cookie.country || 'us'

        const getCountryData = (variants = []) => {
          const variant = variants[0]

          if (!variant) return null

          const { price, subscription_price: subPrice, currency_symbol: currency } = variant.variant_countries.find(c => c.country_iso.toLowerCase() === country)

          return { price, subPrice, currency }
        }

        const fetchVariantsDetail = async (product_id) => {

          if (!product_id) return null

          const host = "https://fluid.app"

          const url = new URL(`${host}/api/products/${product_id}`)

          try {
            const res = await fetch(url)
            const data = await res.json()

            if (!data) return null;

            return getCountryData(data.variants || [])
          }
          catch {
            return null
          }
        }

        const elements = [...document.querySelectorAll('[id^="product_"]')];
        const promises = elements.forEach(async element => {
          const id = element.getAttribute("id").split("_")[1];

          if (!id) {
            element.style.display = ""
            return null
          };

          const res = await fetchVariantsDetail(id)

          if (!res) {
            element.style.display = ""
            return null
          };

          let { price, currency } = res

          price = Number(price).toFixed(2)
          price = currency + price
          element.textContent = price
          element.style.display = ""
        })
      })
    </script>
  </body>
</html>
