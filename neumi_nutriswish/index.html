<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <!-- css library import -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fastly.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../../base/css/style.css" />
  </head>
  <body>
    <div  id="nutriwish" class='custom-landing-page neumi-nutriswish-landing-page' data-product="{{product_id}}" style="display:none">
      {{>Breadcrumb}}
      <!-- PRODUCT DESCRIPTION -->
      {{>ProductDescriptionLayout}}

      <!--As seen section-->
      {{>AsSeenOn}}

      <!-- Video Section -->
      {{>VideoLayout}}

      <!-- Tab section -->
      {{>TabLayout}}

      <!-- Benefits -->
      {{>BenefitsLayout2}}

      <!-- Product List(square image) -->
      {{>ProductPostListLayout}}

      <!-- Key ingredients section -->
      {{>KeyIngredientsLayout}}

      <!-- How to use -->
      {{>HowToUseLayout}}
      <!-- FAQS  -->
      {{>FaqAccordionLayout}}
      <!-- Support -->
      {{>CTA}}
    </div>


    <!-- Js library import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/studio-freight/lenis@latest/bundled/lenis.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <script>
      $(document).ready(function () {
      // video popup
        $("[data-fancybox]").fancybox({
          youtube: {
            controls: 0,
            modestbranding: 1, // Use modestbranding instead of showinfo
          },
        });
      });
      document.addEventListener("DOMContentLoaded", function () {
        /**************Subscribe Card Toggle*************/
        const subscribeCard = document.querySelector(".subscribe-card");
        const subscribeCheckbox = document.getElementById("subscribe");
        const oneTimeOrderCheckbox = document.getElementById("onetime_order");

        const selectQuantityElement = document.getElementById("group-checkout-quantity");
        const hiddenQuantityInput = document.getElementById("checkout-quantity");

        function updateHiddenInput() { // Function to update hidden input value when select changes
            hiddenQuantityInput.value = selectQuantityElement.value;
        }


        selectQuantityElement.addEventListener("change", updateHiddenInput);


        updateHiddenInput(); // Initial assignment on page load

        function toggleSubscribeCard(checked) {
          subscribeCard.classList.toggle("is-active", checked);
        }

        subscribeCheckbox.addEventListener("change", toggleSubscribeCard);
        oneTimeOrderCheckbox.addEventListener("change", () =>
          toggleSubscribeCard(false)
        );

        /**************TAB MENU*************/
        const tabLists = document.querySelectorAll(".tab-menu");

        function showTab(tabList, index) {
          const tabsInList = tabList.querySelectorAll(".tab-menu li");
          const panelsInList =
          tabList.parentElement.nextElementSibling.querySelectorAll(
            ".tab-content-item"
          );

          tabsInList.forEach((tab) => tab.classList.remove("active"));
          panelsInList.forEach((panel) => panel.classList.remove("active"));

          tabsInList[index].classList.add("active");
          panelsInList[index].classList.add("active");
        }

        tabLists.forEach((tabList) => {
          const tabs = tabList.querySelectorAll(".tab-menu li");

          tabs.forEach((tab, index) => {
            tab.addEventListener("click", () => showTab(tabList, index));
          });

          // Show the first tab in each list by default
          showTab(tabList, 0);
        });

        /**************ACCORDION*************/
        const accItem = document.querySelectorAll(".acc-item");
        accItem.forEach((item, index) => {
          let accHeader = item.querySelector(".acc-item_header");
          accHeader.addEventListener("click", () => {
            let accBody = item.querySelector(".acc-item_body");
            if (!item.classList.contains("acc-item_active")) {
              item.classList.add("acc-item_active");
              accBody.style.maxHeight = accBody.scrollHeight + 32 + "px";
              accItem.forEach((element, ind) => {
                let elementBody = element.querySelector(".acc-item_body");
                if (!(ind === index)) {
                  element.classList.remove("acc-item_active");
                  elementBody.style.maxHeight = null;
                }
              });
            } else {
              item.classList.remove("acc-item_active");
              accBody.style.maxHeight = null;
            }
          });
        });

      });

    </script>

    <!-- SLIDER -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        /**************PRODUCT SLIDER*************/
        const previewSlider = new Splide("#preview-slider", {
          rewind: true,
          pagination: false,
          arrows: false
        });
        const thumbnailsSlider = new Splide("#thumbnail-slider", {
          start: 0,
          perPage: 6,
          gap: 10,
          rewind: true,
          pagination: false,
          isNavigation: true,
          mediaQuery: "min",
          breakpoints: {
            576: {
              perPage: 6,
              width: 440,
            },
          },
        });

        previewSlider.sync(thumbnailsSlider);
        previewSlider.mount();
        thumbnailsSlider.mount();

        /**************AS SEEN SLIDER*************/
        var asSeen = new Splide("#as-seen_slider", {
          autoWidth: true,
          arrows: false,
          pagination: false,
          type: "loop",
          perPage: 1,
          autoplay: true,
          interval: 2000,
          cover: false,
          gap: "4rem",
          breakpoints: {
            1024: {
              perPage: 7,
              gap: "3rem",
            },
            576: {
              perPage: 4,
            },
          },
        });

        asSeen.mount();

        /**************TAB:VIDEO SLIDER*************/
        var tabSlider = new Splide("#tab-slider", {
          arrows: false,
          pagination: false,
          type: "loop",
          perPage: 1,
          cover: false,
          gap: "12px",
          mediaQuery: "min",
          padding: '5rem',
          breakpoints: {
            1280: {
              perPage: 5,
            },
            1024: {
              perPage: 4,
            },
            768: {
              perPage: 3,
            },
            576: {
              perPage: 2,
              padding: "0",
              arrows: true,
            },
          },
        });

        tabSlider.mount();

        /**************KEY INGREDIENTS SLIDER*************/
        var keyIngredientsSliderMobile = new Splide("#key-ingredients-slider-mobile", {
          arrows: false,
          pagination: false,
          type: "loop",
          perPage: 1,
          cover: false,
          gap: "2rem",
          padding: "5rem",
          mediaQuery: "min",
          breakpoints: {
            576: {
              perPage: 2,
            },
          },
        });


        var keyIngredientsSliderDesktop = new Splide("#key-ingredients-slider-desktop", {
          arrows: false,
          pagination: false,
          perPage: 1,
          arrows: true,
          cover: false,
          gap: "2rem",
          mediaQuery: "min",
          rewind: false,
          breakpoints: {
            1280: {
              perPage: 3,
              width: "75%"
            },
            768: {
              perPage: 3,
            },
            576: {
              perPage: 2,
            },
          },
        });

        keyIngredientsSliderMobile.mount();
        keyIngredientsSliderDesktop.mount();

      });

    </script>

    <!-- ANIMATION -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        gsap.registerPlugin(ScrollTrigger);//GSAP ScrollTrigger setup

        /**************PRODUCT BENEFITS ANIMATION*************/
        const featItems = gsap.utils.toArray(".product-feature-item");
        featItems.forEach((items) => {
          gsap.fromTo(
            items,
            { opacity: 0, y: 50 },
            {
              duration: 1.5,
              opacity: 1,
              y: 0,
              scrollTrigger: {
                trigger: ".key-ingredients",
                start: "-30% top",
                end: "bottom center",
                scrub: 1,
              },
            }
          );
        });

        const overlays = gsap.utils.toArray(".overlay-animation .overlay-left");// Select all overlay elements within .page-section

        /**************SQUARE IMAGE PRODUCT ANIMATION*************/
        overlays.forEach((overlay) => { // Loop through each overlay element
          ScrollTrigger.create({
            trigger: overlay.closest(".overlay-animation"),
            start: "-100% top",
            end: "bottom 20%",
            onToggle: (self) => {
              if (self.isActive) {
                gsap.to(overlay, { duration: 1, x: "-100%" });
              } else {
                gsap.to(overlay, { duration: 1, x: 0 });
              }
            },
          });
        });

        const overlaysRight = gsap.utils.toArray(".overlay-animation .overlay-right");


        overlaysRight.forEach((overlay) => { // Loop through each overlay element
          ScrollTrigger.create({
            trigger: overlay.closest(".overlay-animation"),
            start: "-100% top",
            end: "bottom 20%",
            onToggle: (self) => {
              if (self.isActive) {
                gsap.to(overlay, { duration: 1, x: "100%" });
              } else {
                gsap.to(overlay, { duration: 1, x: 0 });
              }
            },
          });
        });

        /**************KEY INGREDIENTS ANIMATION*************/
        const keyItems = gsap.utils.toArray(".ingredients .item");
        keyItems.forEach((items) => {
          gsap.fromTo(
            items,
            { opacity: 0, y: 50, stagger: 0.2 },
            {
              duration: 1.5,
              opacity: 1,
              y: 0,
              stagger: 0.2,
              scrollTrigger: {
                trigger: ".ingredients",
                start: "-80% top",
                end: "bottom 20%",
              },
            }
          );
        });

        /**************FAQ ANIMATION*************/
        const faqs = gsap.utils.toArray(".acc-item");
        gsap.fromTo(
          faqs,
          { opacity: 0, y: 50, stagger: 0.3 },
          {
            duration: 1.5,
            opacity: 1,
            stagger: 0.3,
            y: 0,

            scrollTrigger: {
              trigger: ".acc",
              start: "-100% top",
              end: "bottom center",
            },
          }
        );

        const wrappers = document.querySelectorAll(
          ".key-ingredients , .innovation, .easy-app, .lasting-benefit"
        );
        const className = "is-active";

        const observer = new IntersectionObserver((entries) => {
          for (const entry of entries) {
            if (entry.isIntersecting) {
              entry.target.classList.add(className);
            } else {
              entry.target.classList.remove(className);
            }
          }
        });

        wrappers.forEach((wrapper) => {
          observer.observe(wrapper);
        });

      });

    </script>

    <!-- PRICING -->
    <!-- AUTHOR: SAMEER KHANAL-->
    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        function extractCookie(...keys) {
          return document.cookie.split(";").filter(item => keys.some(key => item.includes(key))).reduce((acc, item) => {
            const [key, value] = item.trim().split("=")
            acc[key] = value

            return acc
          }, {})
        }

        const cookie = extractCookie('country');
        const country = window.country || cookie.country || 'us'

        const container = document.getElementById('nutriwish')
        const product = container.getAttribute(["data-product"])
        const defaultValue = { price: 65, subPrice: 50, currency: "$" }

        const getCountryData = (variants = []) => {
          const variant = variants[0]

          if (!variant) return defaultValue

          const { price, subscription_price: subPrice, currency_symbol: currency } = variant.variant_countries.find(c => c.country_iso.toLowerCase() === country)

          return { price, subPrice, currency }
        }

        const fetchVariantsDetail = async (product_id) => {

          if (!product_id) return defaultValue

          const host =  "https://fluid.app"

          const url = new URL(`${host}/api/products/${product_id}`)

          try {
            const res = await fetch(url)
            const data = await res.json()

            if (!data) return defaultValue;

            return getCountryData(data.variants || [])
          }
          catch {
            return defaultValue
          }
        }

        const updateSave = (price, subPrice, currency) => {
          const saved = Number(price - subPrice).toFixed(2);
          const element = document.getElementById("saving")
          element.textContent = `${currency}${saved}`
        }

        const updateComponent = (price, subPrice) => {
          const body = document.getElementById('nutriwish')
          const oneTimePrice = document.getElementById("onetime_order_price")
          const oneTimePriceCross = document.getElementById("crossed_onetime_price")
          const subscriptionPrice = document.getElementById("subscribe_price")

          oneTimePrice.textContent = price
          oneTimePriceCross.textContent = price
          subscriptionPrice.textContent = subPrice
          body.style.display = ''

        }

        let { price, subPrice, currency } = await fetchVariantsDetail(product) || defaultValue
        price = Number(price).toFixed(2)
        subPrice = Number(subPrice).toFixed(2)
        updateSave(price, subPrice, currency)

        subPrice = currency + subPrice + '/mo'
        price = currency + price

        updateComponent(price, subPrice)
      })
    </script>

  </body>
</html>
